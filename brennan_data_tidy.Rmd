---
title: "Reading and tidying data"
author: E. Brennan Bollman
date: '`r format(Sys.time(), "%y-%m-%d")`'
output: github_document
---

```{r setup, INCLUDE = FALSE}
library(tidyverse)
library(rvest)
library(httr)
library(readxl)

knitr::opts_chunk$set(
  fig.width = 10,
  fig.asp = 0.6,
  out.width = "90%"
)

theme_set(theme_bw() + theme(legend.position = "bottom")) 

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d()
scale_fill_discrete = scale_fill_viridis_d()
```


## Aid Worker Security Database

URL: https://aidworkersecurity.org/incidents
Select: 'all' in all fields to obtain the most complete form of the data
Download csv

Note: not sure if we should try to scrape from web to make this more reproducible. 

### Read in data

```{r}
aidworker_df = 
  read_csv("data/security_incidents_2020-11-23.csv") %>% 
  janitor::clean_names()
```

I think this looks fairly tidy? Each incident_id is row. There are lots of variables, but I think mostly will be able to manipulate with `mutate` and `group_by` in further operations on dataset. Lmk what you all think. 

Data dictionary: https://aidworkersecurity.org/about

### Quick EDA

Most deadly countries for aid workers.

```{r}
aidworker_df %>%
  group_by(country) %>% 
  summarize(tot_affected_per_country = sum(total_affected, na.rm = TRUE)) %>% 
  mutate(rank = min_rank(desc(tot_affected_per_country))) %>% 
  filter(rank < 6) %>% 
  knitr::kable()
```

Means of attack

```{r}
aidworker_df %>%
  count(means_of_attack) %>%
  mutate(rank = min_rank(desc(n))) %>% 
  arrange(rank) %>% 
  knitr::kable()
```

International workers affected

```{r}
aidworker_df %>% 
  group_by(country) %>% 
  summarize(tot_intl_per_country = sum(total_internationals, na.rm = TRUE)) %>% 
  mutate(rank = min_rank(desc(tot_intl_per_country))) %>% 
  filter(rank < 6) %>% 
  knitr::kable()
```

National workers affected

```{r}
aidworker_df %>% 
  group_by(country) %>% 
  summarize(tot_natl_per_country = sum(total_nationals, na.rm = TRUE)) %>% 
  mutate(rank = min_rank(desc(tot_natl_per_country))) %>% 
  filter(rank < 6) %>% 
  knitr::kable()
```


Syria per year

```{r}
aidworker_df %>% 
  filter(country == "Syrian Arab Republic") %>% 
  group_by(year) %>% 
  summarize(syria_tot_affected = sum(total_affected, na.rm = TRUE)) %>% 
  mutate(rank = min_rank(desc(syria_tot_affected))) %>% 
  arrange(rank) %>% 
  knitr::kable()
```


## SHCC dataset - 'Safeguarding Health in Conflict Coalition'

URL: https://data.humdata.org/dataset/shcchealthcare-dataset
Downloaded Afghanistan and Syria 2019 data

### Afghanistan

```{r}
afghan_shcc_colnames = 
  read_excel("data/2019-shcc-healthcare-afghanistan-data.xlsx", n_max = 0) %>%
  names()

afghan_shcc_df = 
  read_excel("data/2019-shcc-healthcare-afghanistan-data.xlsx", skip = 2, col_names = afghan_shcc_colnames) %>% 
  janitor::clean_names()
```

### Syria

```{r}
syria_shcc_colnames = 
  read_excel("data/2019-shcc-healthcare-syria-data.xlsx", n_max = 0) %>%
  names()

syria_shcc_df = 
  read_excel("data/2019-shcc-healthcare-syria-data.xlsx", skip = 2, col_names = syria_shcc_colnames) %>% 
  janitor::clean_names()
```


```{r}
syria_shcc_df %>%
  group_by(country) %>% 
  mutate(tot_hcw_affected = 
           total_health_worker_killed + 
           total_health_worker_kidnapped + 
           total_health_worker_arrested + 
           total_health_worker_injured + 
           total_health_worker_assaulted) %>% 
  count(tot_hcw_affected)
```

