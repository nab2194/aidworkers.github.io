---
title: "Section 1"
author: "Natalie Boychuk, E. Brennan Bollman, Emily Bamforth, Alisha Sarakki, and Kailey Rishovd"
date: "11/26/2020"
output: github_document
---

This document is a working draft of section 1 of our final report, which will focus on global levels of violence against aid workers. 

```{r setup and data visualization preferences}
library(tidyverse)
library(dplyr)
library(patchwork)
library(leaflet)
library(lubridate)
library(rvest)
library(httr)
devtools::install_github("benmarwick/wordcountaddin",  type = "source", dependencies = TRUE)
knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)
theme_set(theme_minimal() + theme(legend.position = "bottom"))
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

## Data import and tidying

```{r scraping aidworker data and basic tidying}
url = "https://aidworkersecurity.org/incidents/search"
aidworker_html = read_html(url)

aidworker_df = 
  aidworker_html %>% 
  html_nodes(css = "table") %>%  
  first() %>% 
  html_table() %>% 
  as_tibble()

aidworker_df = 
distinct(aidworker_df) 

aidworker_tidy_df =
  aidworker_df %>% 
  janitor::clean_names() %>% 
  mutate(intl_org_affected = 
           case_when(
             un != 0 ~ "yes",
             ingo != 0 ~ "yes",
             icrc != 0 ~ "yes",
             ifrc != 0 ~ "yes",
             other != 0 ~ "yes",
             lngo_and_nrcs != 0 ~ "no"
           ),
         intl_org_affected = as.factor(intl_org_affected)) %>% 
  rename(year = year_sort_descending) %>% 
  select(-source, -verified) %>% 
  relocate(id, month, day, year, country, intl_org_affected)
```

Brennan notes: 

*why did we use distinct here? 

* I think this `case_when` approach works to identify whether an international org was affected, instead of the pivot idea. Otherwise, I agree with Natalie that there's no way to do it without making 6 copies of each incident. The existing data already seems to be the clearest way to present the number of people from each type of org affected, and we can plot that.

* if happy with cleaning, we can rename the `aidworker_tidy_df` as just `aidworker_df`


## EDA of Attack patterns: International vs National

#### Look at frequency of attacks on various types of organizations 

```{r}
aidworker_tidy_df %>% 
  ggplot(aes(x = intl_org_affected)) + 
  geom_bar()
```


