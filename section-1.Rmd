---
title: "Section 1"
author: "Natalie Boychuk, E. Brennan Bollman, Emily Bamforth, Alisha Sarakki, and Kailey Rishovd"
date: "11/26/2020"
output: github_document
---

This document is a working draft of section 1 of our final report, which will focus on global levels of violence against aid workers. 

```{r setup and data visualization preferences}
library(tidyverse)
library(dplyr)
library(patchwork)
library(leaflet)
library(lubridate)
library(rvest)
library(httr)
devtools::install_github("benmarwick/wordcountaddin",  type = "source", dependencies = TRUE)
knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)
theme_set(theme_minimal() + theme(legend.position = "bottom"))
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

## Data import and tidying

```{r scraping aidworker data and basic tidying}
url = "https://aidworkersecurity.org/incidents/search"
aidworker_html = read_html(url)

aidworker_df = 
  aidworker_html %>% 
  html_nodes(css = "table") %>%  
  first() %>% 
  html_table() %>% 
  as_tibble()

aidworker_df = 
distinct(aidworker_df) 

aidworker_df =
  aidworker_df %>% 
  janitor::clean_names() %>% 
  mutate(intl_org_affected = 
           case_when(
             un != 0 ~ "yes",
             ingo != 0 ~ "yes",
             icrc != 0 ~ "yes",
             ifrc != 0 ~ "yes",
             other != 0 ~ "yes",
             lngo_and_nrcs != 0 ~ "no"
           ),
         intl_org_affected = as.factor(intl_org_affected)) %>% 
  rename(year = year_sort_descending) %>% 
  select(-source, -verified) %>% 
  relocate(id, month, day, year, country, intl_org_affected)
```

Brennan notes: 

*why did we use distinct here? 

* I think this `case_when` approach works to identify whether an international org was affected, instead of the pivot idea. Otherwise, I agree with Natalie that there's no way to do it without making 6 copies of each incident. The existing data already seems to be the clearest way to present the number of people from each type of org affected, and we can plot that.

* if happy with cleaning, we can rename the `aidworker_tidy_df` as just `aidworker_df`

### Look at frequency of attacks on staff of various types of organizations 

```{r}
aidworker_df %>% 
  ggplot(aes(x = intl_org_affected)) + 
  geom_bar()
```

Brennan: I'm stuck on this part. Natalie - you were thinking about it conceptually a lot, any ideas?

### International vs National staff attacks

```{r}
aidworker_df %>%
  group_by(year) %>% 
  summarize(tot_national = sum(total_national_staff),
            tot_intl = sum(total_international_staff),
            tot_both = sum(total_victims),
            pct_intl = (tot_intl/tot_both)*100,
            pct_national = (tot_national/tot_both)*100) %>%
  knitr::kable()

## If look at last row of data, appears "NA" is the total

aidworker_df %>%
  group_by(year) %>% 
  summarize(tot_national = sum(total_national_staff),
            tot_intl = sum(total_international_staff),
            tot_both = sum(total_victims),
            pct_intl = (tot_intl/tot_both)*100,
            pct_national = (tot_national/tot_both)*100) %>% 
  ggplot(aes(x = year, y = pct_national)) + 
  geom_line()
```

Roughly this shows that proportions of nationals attacked has always been higher than internationals, with increasing percentage of national staff attacked over time. 

```{r}
aidworker_df %>% 
  drop_na(year) %>% 
  group_by(year) %>% 
   summarize(tot_national = sum(total_national_staff),
            tot_intl = sum(total_international_staff),
            tot_both = sum(total_victims)) %>% 
  ggplot(aes(x = year)) + 
  geom_line(aes(y = tot_national, color = "National Staff")) + 
  geom_line(aes(y = tot_intl, color = "International Staff")) + 
  labs(title = "Aid Worker Attacks over time",
       x = "Year",
       y = "Number of Aid Workers Attacked")
```

Number of aid worker attacks are increasing over time, especially among national staff.

### Type of Attack

```{r}
aidworker_df %>% 
  filter(means_of_attack == "Kidnapping") %>% 
  group_by(year) %>% 
  summarize(tot_national = sum(total_national_staff),
            tot_intl = sum(total_international_staff),
            tot_both = sum(total_victims)) %>% 
  ggplot(aes(x = year)) + 
  geom_line(aes(y = tot_national, color = "National Staff")) + 
  geom_line(aes(y = tot_intl, color = "International Staff")) + 
  labs(title = "Aid Worker Kidnapping over time",
       x = "Year",
       y = "Number of Aid Workers Kidnapped")
```

Kidnapping also increasing over time, particularly among national staff. Could put this side-by-side the total attack line plot.

#### Attempts to visualize type of attack over time - failed so far


```{r}
aidworker_df %>% 
  drop_na(year) %>% 
  group_by(year, means_of_attack) %>% 
  ggplot(aes(x = year, y = total_victims, color = means_of_attack)) + 
  geom_point()
```

Above is not good.

```{r}
aidworker_df %>% 
  drop_na(year) %>% 
  group_by(year, means_of_attack) %>% 
  filter(year == 2020) %>% 
  ggplot(aes(x = means_of_attack, fill = means_of_attack)) + 
  geom_bar()
```

I like this bar chart, but I think 'count' is the number of incidents, not the number of people affected. Would be really cool if this could be a shiny plot where could change year in a drop down to see how this changes over time? Or make a plotly so that you can hover over label to see number of intl/natl affected by each type of attack?

I'm not sure how to make those things work though.  

